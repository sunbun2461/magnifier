<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Gallery with Vertical Thumbnails - Enhanced Magnifier</title>
	<link rel="stylesheet" href="css/gallery.css">
</head>
<body>
    <!-- Navigation Header -->
    <nav class="main-nav">
        <ul>
            <li><a href="demo.html">Demo</a></li>
            <li><a href="magnifier.html">Magnifier</a></li>
            <li><a href="gallery.html" class="active">Gallery</a></li>
        </ul>
    </nav>

    <div class="gallery-container">
        <div class="gallery-header">
            <h1>üñºÔ∏è Enhanced Gallery</h1>
            <p>Vertical thumbnails with image magnification</p>
            <p class="gallery-instructions">üí° Hover over thumbnails to preview ‚Ä¢ Click thumbnails to select ‚Ä¢ Use arrows to navigate ‚Ä¢ Hover on main image to magnify</p>
        </div>

        <div class="gallery-layout">
            <!-- Vertical thumbnail slider - now on the left -->
            <div class="thumbnail-slider">
                <button class="chevron-button thumbnail-nav-button thumbnail-nav-up" id="thumbnail-up">
                    <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 32 33" fill="none">
                        <path d="M8.21313 17.8503C7.58813 17.1992 7.58813 16.1419 8.21313 15.4909L17.8131 5.49088C18.4381 4.83984 19.4531 4.83984 20.0781 5.49088C20.7031 6.14192 20.7031 7.19922 20.0781 7.85026L11.6081 16.6732L20.0731 25.4961C20.6981 26.1471 20.6981 27.2044 20.0731 27.8555C19.4481 28.5065 18.4331 28.5065 17.8081 27.8555L8.20812 17.8555L8.21313 17.8503Z" fill="currentColor"/>
                    </svg>
                </button>
                <div class="thumbnail-container" id="thumbnail-container">
                    <!-- Thumbnails populated by JS -->
                </div>
                <button class="chevron-button thumbnail-nav-button thumbnail-nav-down" id="thumbnail-down">
                    <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 32 33" fill="none">
                        <path d="M23.7869 17.8503C24.4119 17.1992 24.4119 16.1419 23.7869 15.4909L14.1869 5.49088C13.5619 4.83984 12.5469 4.83984 11.9219 5.49088C11.2969 6.14192 11.2969 7.19922 11.9219 7.85026L20.3919 16.6732L11.9269 25.4961C11.3019 26.1471 11.3019 27.2044 11.9269 27.8555C12.5519 28.5065 13.5669 28.5065 14.1919 27.8555L23.7919 17.8555L23.7869 17.8503Z" fill="currentColor"/>
                    </svg>
                </button>
            </div>

            <!-- Main image display with side navigation -->
            <div class="main-image-container main-nav-buttons">
                <button class="chevron-button main-nav-button prev" id="main-prev">
                    <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 32 33" fill="none">
                        <path d="M8.21313 17.8503C7.58813 17.1992 7.58813 16.1419 8.21313 15.4909L17.8131 5.49088C18.4381 4.83984 19.4531 4.83984 20.0781 5.49088C20.7031 6.14192 20.7031 7.19922 20.0781 7.85026L11.6081 16.6732L20.0731 25.4961C20.6981 26.1471 20.6981 27.2044 20.0731 27.8555C19.4481 28.5065 18.4331 28.5065 17.8081 27.8555L8.20812 17.8555L8.21313 17.8503Z" fill="currentColor"/>
                    </svg>
                </button>
                <img id="main-image" 
                     class="main-image" 
                     src="https://images.unsplash.com/photo-1523275335684-37898b6baf30?ixlib=rb-4.0.3&auto=format&fit=crop&w=600&q=80" 
                     alt="Premium Watch">
                <button class="chevron-button main-nav-button next" id="main-next">
                    <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 32 33" fill="none">
                        <path d="M23.7869 17.8503C24.4119 17.1992 24.4119 16.1419 23.7869 15.4909L14.1869 5.49088C13.5619 4.83984 12.5469 4.83984 11.9219 5.49088C11.2969 6.14192 11.2969 7.19922 11.9219 7.85026L20.3919 16.6732L11.9269 25.4961C11.3019 26.1471 11.3019 27.2044 11.9269 27.8555C12.5519 28.5065 13.5669 28.5065 14.1919 27.8555L23.7919 17.8555L23.7869 17.8503Z" fill="currentColor"/>
                    </svg>
                </button>
            </div>

            <!-- Pagination dots for mobile -->
            <div class="embla__dots" id="embla-dots">
                <!-- Dots will be populated by JavaScript -->
            </div>

            <!-- Product information -->
            <div class="product-info">
                <h2 class="product-title" id="product-title">Premium Watch</h2>
                <div class="product-price" id="product-price">$299.99</div>
                <div class="product-description" id="product-description">
                    Elegant timepiece with precision movement and classic design.
                </div>
                
                <button class="btn btn-primary">Add to Cart</button>

                <div class="features">
                    <h3>Gallery Features:</h3>
                    <ul>
                        <li>Vertical thumbnails</li>
                        <li>Image magnification</li>
                        <li>Smooth transitions</li>
                        <li>Touch friendly</li>
                        <li>Responsive design</li>
                    </ul>
                </div>
            </div>
        </div>
    </div>

    <!-- Local Embla Carousel -->
    <script src="embla-carousel.js"></script>
    
    <!-- Enhanced Magnifier -->
    <script src="enhanced-magnifier.js"></script>

    <script>
        // Lightweight gallery data
        const galleryItems = [
            {
                title: "Tall Skyscraper",
                price: "$1,299.99", 
                description: "Very tall and skinny skyscraper architectural photo with extreme vertical aspect ratio (1:3).",
                small: "https://as1.ftcdn.net/v2/jpg/01/20/67/40/1000_F_120674054_1J0fZH472Pu7KnNLIan4jz3BZZijokqg.jpg",
                large: "https://as1.ftcdn.net/v2/jpg/01/20/67/40/1000_F_120674054_1J0fZH472Pu7KnNLIan4jz3BZZijokqg.jpg",
                thumb: "https://as1.ftcdn.net/v2/jpg/01/20/67/40/1000_F_120674054_1J0fZH472Pu7KnNLIan4jz3BZZijokqg.jpg"
            },
            {
                title: "Classic Gold Watch",
                price: "$299.99", 
                description: "Elegant gold timepiece with leather strap.",
                small: "https://images.unsplash.com/photo-1523275335684-37898b6baf30?ixlib=rb-4.0.3&auto=format&fit=crop&w=600&q=80",
                large: "https://images.unsplash.com/photo-1523275335684-37898b6baf30?ixlib=rb-4.0.3&auto=format&fit=crop&w=1200&q=80",
                thumb: "https://images.unsplash.com/photo-1523275335684-37898b6baf30?ixlib=rb-4.0.3&auto=format&fit=crop&w=150&q=80"
            },
            {
                title: "Smart Watch",
                price: "$449.99",
                description: "Advanced smartwatch with health monitoring.",
                small: "https://images.unsplash.com/photo-1434493789847-2f02dc6ca35d?ixlib=rb-4.0.3&auto=format&fit=crop&w=600&q=80",
                large: "https://images.unsplash.com/photo-1434493789847-2f02dc6ca35d?ixlib=rb-4.0.3&auto=format&fit=crop&w=1200&q=80",
                thumb: "https://images.unsplash.com/photo-1434493789847-2f02dc6ca35d?ixlib=rb-4.0.3&auto=format&fit=crop&w=150&q=80"
            },
            {
                title: "Vintage Chronograph",
                price: "$599.99",
                description: "Retro chronograph with authentic styling.",
                small: "https://images.unsplash.com/photo-1594534475808-b18fc33b045e?ixlib=rb-4.0.3&auto=format&fit=crop&w=600&q=80",
                large: "https://images.unsplash.com/photo-1594534475808-b18fc33b045e?ixlib=rb-4.0.3&auto=format&fit=crop&w=1200&q=80",
                thumb: "https://images.unsplash.com/photo-1594534475808-b18fc33b045e?ixlib=rb-4.0.3&auto=format&fit=crop&w=150&q=80"
            },
            {
                title: "Luxury Dress Watch",
                price: "$899.99",
                description: "Sophisticated dress watch for formal occasions.",
                small: "https://images.unsplash.com/photo-1522312346375-d1a52e2b99b3?ixlib=rb-4.0.3&auto=format&fit=crop&w=600&q=80",
                large: "https://images.unsplash.com/photo-1522312346375-d1a52e2b99b3?ixlib=rb-4.0.3&auto=format&fit=crop&w=1200&q=80",
                thumb: "https://images.unsplash.com/photo-1522312346375-d1a52e2b99b3?ixlib=rb-4.0.3&auto=format&fit=crop&w=150&q=80"
            },
            {
                title: "Sport Watch",
                price: "$379.99",
                description: "Durable sport watch with water resistance.",
                small: "https://images.unsplash.com/photo-1609081219090-a6d81d3085bf?ixlib=rb-4.0.3&auto=format&fit=crop&w=600&q=80",
                large: "https://images.unsplash.com/photo-1609081219090-a6d81d3085bf?ixlib=rb-4.0.3&auto=format&fit=crop&w=1200&q=80",
                thumb: "https://images.unsplash.com/photo-1609081219090-a6d81d3085bf?ixlib=rb-4.0.3&auto=format&fit=crop&w=150&q=80"
            },
            {
                title: "Mechanical Watch",
                price: "$749.99",
                description: "Precision mechanical movement with exposed gears and elegant design.",
                small: "https://images.unsplash.com/photo-1524592094714-0f0654e20314?ixlib=rb-4.0.3&auto=format&fit=crop&w=600&q=80",
                large: "https://images.unsplash.com/photo-1524592094714-0f0654e20314?ixlib=rb-4.0.3&auto=format&fit=crop&w=1200&q=80",
                thumb: "https://images.unsplash.com/photo-1524592094714-0f0654e20314?ixlib=rb-4.0.3&auto=format&fit=crop&w=150&q=80"
            },
            {
                title: "Rose Gold Timepiece",
                price: "$1,099.99",
                description: "Luxurious rose gold watch with diamond accents and mother-of-pearl dial.",
                small: "https://images.unsplash.com/photo-1549972574-8e3e1ed6a347?ixlib=rb-4.0.3&auto=format&fit=crop&w=600&q=80",
                large: "https://images.unsplash.com/photo-1549972574-8e3e1ed6a347?ixlib=rb-4.0.3&auto=format&fit=crop&w=1200&q=80",
                thumb: "https://images.unsplash.com/photo-1549972574-8e3e1ed6a347?ixlib=rb-4.0.3&auto=format&fit=crop&w=150&q=80"
            },
            {
                title: "Digital Sports Watch",
                price: "$199.99",
                description: "Modern digital watch with GPS tracking and fitness monitoring capabilities.",
                small: "https://images.unsplash.com/photo-1551698618-1dfe5d97d256?ixlib=rb-4.0.3&auto=format&fit=crop&w=600&q=80",
                large: "https://images.unsplash.com/photo-1551698618-1dfe5d97d256?ixlib=rb-4.0.3&auto=format&fit=crop&w=1200&q=80",
                thumb: "https://images.unsplash.com/photo-1551698618-1dfe5d97d256?ixlib=rb-4.0.3&auto=format&fit=crop&w=150&q=80"
            },
            {
                title: "Classic Pocket Watch",
                price: "$429.99",
                description: "Vintage-inspired pocket watch with chain and Roman numeral display.",
                small: "https://images.unsplash.com/photo-1596701062351-8c2c14d1fdd0?ixlib=rb-4.0.3&auto=format&fit=crop&w=600&q=80",
                large: "https://images.unsplash.com/photo-1596701062351-8c2c14d1fdd0?ixlib=rb-4.0.3&auto=format&fit=crop&w=1200&q=80",
                thumb: "https://images.unsplash.com/photo-1596701062351-8c2c14d1fdd0?ixlib=rb-4.0.3&auto=format&fit=crop&w=150&q=80"
            },
            {
                title: "Aviation Chronograph",
                price: "$899.99",
                description: "Pilot-inspired chronograph with multiple subdials and titanium construction.",
                small: "https://images.unsplash.com/photo-1533139502658-0198f920d8e8?ixlib=rb-4.0.3&auto=format&fit=crop&w=600&q=80",
                large: "https://images.unsplash.com/photo-1533139502658-0198f920d8e8?ixlib=rb-4.0.3&auto=format&fit=crop&w=1200&q=80",
                thumb: "https://images.unsplash.com/photo-1533139502658-0198f920d8e8?ixlib=rb-4.0.3&auto=format&fit=crop&w=150&q=80"
            }
        ];

        let emblaApi;
        let currentMagnifier = null;
        let currentIndex = 0;
        let hoverTimeout = null; // For managing hover delays

        // Utility: detect mobile
        function isMobile() {
            return window.matchMedia && window.matchMedia('(max-width: 1024px)').matches;
        }

        // Initialize gallery
        function init() {
            console.log('Initializing gallery with first item:', galleryItems[0]);
            
            // Set initial image and info
            const firstItem = galleryItems[0];
            const mainImage = document.getElementById('main-image');
            mainImage.src = firstItem.small;
            mainImage.alt = firstItem.title;
            
            // Initialize current index
            currentIndex = 0;
            console.log('Set currentIndex to:', currentIndex);
            
            createThumbnails();
            createDots();
            setupThumbnailScrolling();
            
            // Setup magnifier only on desktop
            if (!isMobile()) {
                setupMagnifier(firstItem);
            }
            
            updateInfo(firstItem);
            console.log('Gallery initialization complete');
        }

        // Create thumbnail slides
        function createThumbnails() {
            const container = document.getElementById('thumbnail-container');
            container.innerHTML = '';

            galleryItems.forEach((item, index) => {
                const slide = document.createElement('div');
                slide.className = `thumbnail-slide ${index === 0 ? 'is-selected' : ''}`;
                slide.innerHTML = `<img src="${item.thumb}" alt="${item.title}">`;
                
                // Click functionality for both mobile and desktop
                slide.addEventListener('click', () => {
                    selectImage(index);
                });

                // Hover functionality - only on desktop (non-mobile devices)
                if (!isMobile()) {
                    slide.addEventListener('mouseenter', () => {
                        if (index !== currentIndex) {
                            // Select on hover for desktop only
                            selectImage(index);
                        }
                    });
                }

                container.appendChild(slide);
            });
        }

        // Create pagination dots for mobile
        function createDots() {
            const dotsContainer = document.getElementById('embla-dots');
            dotsContainer.innerHTML = '';

            galleryItems.forEach((item, index) => {
                const dot = document.createElement('button');
                dot.className = `embla__dot ${index === 0 ? 'is-selected' : ''}`;
                dot.setAttribute('aria-label', `Go to slide ${index + 1}`);
                
                dot.addEventListener('click', () => {
                    selectImage(index);
                });

                dotsContainer.appendChild(dot);
            });
        }

        // Setup thumbnail scrolling
        function setupThumbnailScrolling() {
            const container = document.getElementById('thumbnail-container');
            
            // Add thumbnail navigation buttons
            document.getElementById('thumbnail-up').addEventListener('click', () => {
                container.scrollBy({ top: -100, behavior: 'smooth' });
            });
            
            document.getElementById('thumbnail-down').addEventListener('click', () => {
                container.scrollBy({ top: 100, behavior: 'smooth' });
            });

            // Add mousewheel scrolling support
            container.addEventListener('wheel', (event) => {
                // Prevent the default scrolling behavior
                event.preventDefault();
                
                // Scroll the container
                container.scrollBy({ top: event.deltaY, behavior: 'smooth' });
            }, { passive: false });
            
            // Main image side navigation
            document.getElementById('main-prev').addEventListener('click', () => {
                if (currentIndex > 0) {
                    selectImage(currentIndex - 1);
                }
            });
            
            document.getElementById('main-next').addEventListener('click', () => {
                if (currentIndex < galleryItems.length - 1) {
                    selectImage(currentIndex + 1);
                }
            });

            updateButtons();
        }

        // Update button states
        function updateButtons() {
            // Update main navigation buttons - hide/show instead of opacity
            const prevButton = document.getElementById('main-prev');
            const nextButton = document.getElementById('main-next');
            
            // Hide left arrow on first item
            if (currentIndex === 0) {
                prevButton.style.display = 'none';
            } else {
                prevButton.style.display = 'flex';
            }
            
            // Hide right arrow on last item
            if (currentIndex === galleryItems.length - 1) {
                nextButton.style.display = 'none';
            } else {
                nextButton.style.display = 'flex';
            }
        }

        // Select image
        function selectImage(index) {
            if (index === currentIndex) return;
            
            currentIndex = index;
            const item = galleryItems[index];

            // Update main image
            const mainImage = document.getElementById('main-image');
            mainImage.src = item.small;
            mainImage.alt = item.title;

            // Update thumbnail selection
            document.querySelectorAll('.thumbnail-slide').forEach((slide, i) => {
                slide.classList.toggle('is-selected', i === index);
            });

            // Update dots selection
            document.querySelectorAll('.embla__dot').forEach((dot, i) => {
                dot.classList.toggle('is-selected', i === index);
            });

            updateInfo(item);
            
            // Setup magnifier only on desktop
            if (!isMobile()) {
                setupMagnifier(item);
            }
            
            updateButtons(); // Always update button states when selecting
        }

        // Update product info
        function updateInfo(item) {
            document.getElementById('product-title').textContent = item.title;
            document.getElementById('product-price').textContent = item.price;
            document.getElementById('product-description').textContent = item.description;
        }

        // Setup magnifier
        function setupMagnifier(item) {
            // Skip magnifier setup on mobile devices
            if (isMobile()) {
                console.log("Magnifier disabled on mobile");
                return;
            }
            
            if (currentMagnifier) {
                try {
                    EnhancedImageMagnifier.cleanup();
                } catch (e) {
                    // Cleanup handled
                }
            }

            const mainImage = document.getElementById('main-image');
            
            function initMagnifier() {
                // Fixed dimensions in pixels (29.25rem = 468px)
                const exactWidth = 29.25 * 16; // 468px
                const exactHeight = 29.25 * 16; // 468px
                
                // Load the image temporarily to get natural dimensions
                const tempImg = new Image();
                tempImg.src = item.small;
                
                // Set up magnifier options
                const magnifierOptions = {
                    largeImage: {
                        src: item.large,
                        width: 1200,
                        height: 1200,
                        preserveAspectRatio: true
                    },
                    mode: 'hover',
                    inPlace: true,
                    width: exactWidth,
                    height: exactHeight,
                    zoom: 2,
                    hoverDelayInMs: 0, // Immediate activation
                    fadeDurationInMs: 325,
                    // Fixed styling to prevent height issues
                    enlargedImageContainerStyle: {
                        width: exactWidth + 'px',
                        height: exactHeight + 'px',
                        maxHeight: exactHeight + 'px',
                        overflow: 'hidden' // Prevent magnified image from overflowing
                    },
                    // Control the magnified image position
                    enlargedImageStyle: {
                        objectFit: 'contain',
                        width: 'auto',
                        height: 'auto',
                        maxWidth: 'none',
                        maxHeight: 'none'
                    }
                };
                
                // Special handling for the tall skyscraper image
                if (item.title === "Tall Skyscraper") {
                    magnifierOptions.zoom = 1.5; // Lower zoom for very tall image
                    console.log("Applied special handling for tall skyscraper image");
                }
                
                currentMagnifier = new EnhancedImageMagnifier('#main-image', magnifierOptions);
            }

            if (mainImage.complete) {
                initMagnifier();
            } else {
                mainImage.addEventListener('load', initMagnifier, { once: true });
            }
        }

        // Handle resize
        function handleResize() {
            // Recreate dots if needed
            createDots();
            
            // Only setup magnifier on desktop after resize
            if (!isMobile()) {
                setTimeout(() => setupMagnifier(galleryItems[currentIndex]), 100);
            }
        }

        // Initialize
        document.addEventListener('DOMContentLoaded', init);
        window.addEventListener('resize', handleResize);
    </script>
</body>
</html>
